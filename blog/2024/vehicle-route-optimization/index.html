<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Vehicle Route Optimization with Fuel Constraints | Dipesh Pandey</title> <meta name="author" content="Dipesh Pandey"> <meta name="description" content="A practical guide to implementing a vehicle routing system with fuel constraints using Python and PostGIS"> <meta name="keywords" content="python, javascript, norway, freelancer, contract, typescript, startup, fastapi, django, nodejs, aws, indiehacker, forex, automated trading, blockchain"> <meta property="og:site_name" content="Dipesh Pandey"> <meta property="og:type" content="website"> <meta property="og:title" content="Dipesh Pandey | Vehicle Route Optimization with Fuel Constraints"> <meta property="og:url" content="https://dipespandey.github.io/blog/2024/vehicle-route-optimization/"> <meta property="og:description" content="A practical guide to implementing a vehicle routing system with fuel constraints using Python and PostGIS"> <meta property="og:locale" content="en"> <meta name="twitter:card" content="summary"> <meta name="twitter:title" content="Vehicle Route Optimization with Fuel Constraints"> <meta name="twitter:description" content="A practical guide to implementing a vehicle routing system with fuel constraints using Python and PostGIS"> <script type="application/ld+json">
      {
        "author":
        {
          "@type": "Person",
          "name": "Dipesh  Pandey"
        },
        "url": "https://dipespandey.github.io/blog/2024/vehicle-route-optimization/",
        "@type": "WebSite",
        "description": "A practical guide to implementing a vehicle routing system with fuel constraints using Python and PostGIS",
        "headline": "Vehicle Route Optimization with Fuel Constraints",
        "sameAs": ["https://github.com/dipespandey", "https://telegram.me/dipeshpandey08", "https://www.linkedin.com/in/dipespandey", "https://discord.com/users/747835324931113090"],
        "name": "Dipesh  Pandey",
        "@context": "https://schema.org"
      }
    </script> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.google.com/download?family=Montserrat:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/favicon.ico"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://dipespandey.github.io/blog/2024/vehicle-route-optimization/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> <script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
  mermaid.initialize({ 
    startOnLoad: true, 
    theme: 'forest', 
    securityLevel: 'loose',
    
  });
</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Dipesh </span>Pandey</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/models/">ML Models</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">Projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/reading/">Reading</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h3 class="post-title">Vehicle Route Optimization with Fuel Constraints</h3> <p class="post-meta">September 12, 2024</p> <p class="post-tags">   ·   <a href="/blog/category/vehicle-routing"> <i class="fas fa-tag fa-sm"></i> vehicle-routing</a>   <a href="/blog/category/optimization"> <i class="fas fa-tag fa-sm"></i> optimization</a>   <a href="/blog/category/route-planning"> <i class="fas fa-tag fa-sm"></i> route-planning</a>   </p> </header> <article class="post-content"> <p>In this post, we examine the strategies that delivery companies use to optimize their routes by integrating fuel constraints. This post provides a professional guide to developing an optimal routing strategy for vehicles navigating the United States, balancing fuel efficiency and cost effectiveness.</p> <h3 id="problem-definition">Problem Definition</h3> <p>To address this challenge, our solution must satisfy the following requirements: • A vehicle must be capable of traveling up to 1000 miles on a single tank of fuel. • There is access to approximately 6000 fuel stations with known geographic coordinates and fuel prices. • The objective is to minimize the overall fuel expenditure.</p> <p>Here’s a visual representation of our problem:</p> <div class="mermaid"> graph LR A[Start Location] --&gt; B[Route Planning] B --&gt; C[Find Nearby Stations] C --&gt; D[Calculate Costs] D --&gt; E[Choose Next Stop] E --&gt; F[Destination Reached?] F --&gt;|No| C F --&gt;|Yes| G[End Location] style A fill:#f96,stroke:#333,stroke-width:2px style G fill:#f96,stroke:#333,stroke-width:2px style B fill:#9cf,stroke:#333,stroke-width:2px style C fill:#9f9,stroke:#333,stroke-width:2px style D fill:#f9f,stroke:#333,stroke-width:2px style E fill:#ff9,stroke:#333,stroke-width:2px style F fill:#fcc,stroke:#333,stroke-width:2px </div> <h3 id="proposed-approach">Proposed Approach</h3> <p>Our solution comprises three core components:</p> <ol> <li>Location Services – Integrating the Google Maps API to accurately convert addresses into geographic coordinates.</li> <li>Data Storage – Utilizing PostGIS for efficient storage and querying of fuel station data.</li> <li>Route Optimization – Employing a greedy algorithm to determine the optimal route while considering fuel constraints and cost minimization.</li> </ol> <h3 id="1-location-services">1. Location Services</h3> <p>We begin by integrating the Google Maps API for precise geocoding and route planning. The service converts addresses into coordinates and retrieves route information as demonstrated below:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">googlemaps</span> <span class="kn">import</span> <span class="n">Client</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">Tuple</span>

<span class="k">class</span> <span class="nc">LocationService</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">gmaps</span> <span class="o">=</span> <span class="nc">Client</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">geocode</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">address</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
        <span class="sh">"""</span><span class="s">Convert address to coordinates</span><span class="sh">"""</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">gmaps</span><span class="p">.</span><span class="nf">geocode</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nc">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Could not geocode address: </span><span class="si">{</span><span class="n">address</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="n">location</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="sh">'</span><span class="s">geometry</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">location</span><span class="sh">'</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">location</span><span class="p">[</span><span class="sh">'</span><span class="s">lat</span><span class="sh">'</span><span class="p">],</span> <span class="n">location</span><span class="p">[</span><span class="sh">'</span><span class="s">lng</span><span class="sh">'</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">get_route</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">origin</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> 
                 <span class="n">destination</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Get route points between two locations</span><span class="sh">"""</span>
        <span class="n">route</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">gmaps</span><span class="p">.</span><span class="nf">directions</span><span class="p">(</span>
            <span class="n">origin</span><span class="p">,</span>
            <span class="n">destination</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="sh">"</span><span class="s">driving</span><span class="sh">"</span>
        <span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">route</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nc">ValueError</span><span class="p">(</span><span class="sh">"</span><span class="s">No route found</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># Extract route points
</span>        <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">route</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="sh">'</span><span class="s">legs</span><span class="sh">'</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="sh">'</span><span class="s">steps</span><span class="sh">'</span><span class="p">]:</span>
            <span class="n">points</span><span class="p">.</span><span class="nf">append</span><span class="p">((</span>
                <span class="n">step</span><span class="p">[</span><span class="sh">'</span><span class="s">start_location</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">lat</span><span class="sh">'</span><span class="p">],</span>
                <span class="n">step</span><span class="p">[</span><span class="sh">'</span><span class="s">start_location</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">lng</span><span class="sh">'</span><span class="p">]</span>
            <span class="p">))</span>
        
        <span class="c1"># Add destination
</span>        <span class="n">points</span><span class="p">.</span><span class="nf">append</span><span class="p">((</span>
            <span class="n">route</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="sh">'</span><span class="s">legs</span><span class="sh">'</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="sh">'</span><span class="s">end_location</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">lat</span><span class="sh">'</span><span class="p">],</span>
            <span class="n">route</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="sh">'</span><span class="s">legs</span><span class="sh">'</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="sh">'</span><span class="s">end_location</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">lng</span><span class="sh">'</span><span class="p">]</span>
        <span class="p">))</span>
        
        <span class="k">return</span> <span class="n">points</span>
</code></pre></div></div> <h3 id="2-data-storage">2. Data Storage</h3> <p>We’ll use PostGIS to efficiently store and query fuel stations. Here’s our Django model:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">django.contrib.gis.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="n">django.contrib.gis.geos</span> <span class="kn">import</span> <span class="n">Point</span>

<span class="k">class</span> <span class="nc">FuelStation</span><span class="p">(</span><span class="n">models</span><span class="p">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="nc">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">location</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="nc">PointField</span><span class="p">(</span><span class="n">srid</span><span class="o">=</span><span class="mi">4326</span><span class="p">)</span>  <span class="c1"># SRID for GPS coordinates
</span>    <span class="n">address</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="nc">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">city</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="nc">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="nc">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">retail_price</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="nc">DecimalField</span><span class="p">(</span><span class="n">max_digits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">indexes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">models</span><span class="p">.</span><span class="nc">Index</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">retail_price</span><span class="sh">'</span><span class="p">]),</span>
            <span class="c1"># PostGIS will automatically create spatial index
</span>        <span class="p">]</span>
</code></pre></div></div> <h3 id="3-route-optimization">3. Route Optimization</h3> <p>Now for the core logic. We’ll use a greedy algorithm that:</p> <ol> <li>Follows the route points</li> <li>Checks fuel level at each point</li> <li>Finds the cheapest reachable station when needed If the vehicle can reach the destination without refueling, it will do so. Otherwise, it will find the cheapest reachable station.</li> </ol> <p>Here’s the main optimizer class, broken down into manageable pieces:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">django.contrib.gis.db.models.functions</span> <span class="kn">import</span> <span class="n">Distance</span>
<span class="kn">from</span> <span class="n">django.contrib.gis.measure</span> <span class="kn">import</span> <span class="n">D</span>
<span class="kn">import</span> <span class="n">math</span>
<span class="kn">import</span> <span class="n">logging</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="nf">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">GreedyRouteOptimizer</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">max_range_miles</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">mpg</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">max_range_miles</span> <span class="o">=</span> <span class="n">max_range_miles</span>
        <span class="n">self</span><span class="p">.</span><span class="n">mpg</span> <span class="o">=</span> <span class="n">mpg</span>
        <span class="n">self</span><span class="p">.</span><span class="n">max_tank_gallons</span> <span class="o">=</span> <span class="n">max_range_miles</span> <span class="o">/</span> <span class="n">mpg</span>
</code></pre></div></div> <h4 id="distance-calculation">Distance Calculation</h4> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">calculate_distance</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">point1</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> 
                      <span class="n">point2</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Calculate haversine distance between two points</span><span class="sh">"""</span>
    <span class="n">lat1</span><span class="p">,</span> <span class="n">lon1</span> <span class="o">=</span> <span class="n">point1</span>
    <span class="n">lat2</span><span class="p">,</span> <span class="n">lon2</span> <span class="o">=</span> <span class="n">point2</span>
    <span class="n">R</span> <span class="o">=</span> <span class="mf">3958.8</span>  <span class="c1"># Earth radius in miles
</span>    
    <span class="n">dlat</span> <span class="o">=</span> <span class="n">math</span><span class="p">.</span><span class="nf">radians</span><span class="p">(</span><span class="n">lat2</span> <span class="o">-</span> <span class="n">lat1</span><span class="p">)</span>
    <span class="n">dlon</span> <span class="o">=</span> <span class="n">math</span><span class="p">.</span><span class="nf">radians</span><span class="p">(</span><span class="n">lon2</span> <span class="o">-</span> <span class="n">lon1</span><span class="p">)</span>
    
    <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">math</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="n">dlat</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
         <span class="o">+</span> <span class="n">math</span><span class="p">.</span><span class="nf">cos</span><span class="p">(</span><span class="n">math</span><span class="p">.</span><span class="nf">radians</span><span class="p">(</span><span class="n">lat1</span><span class="p">))</span>
         <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="nf">cos</span><span class="p">(</span><span class="n">math</span><span class="p">.</span><span class="nf">radians</span><span class="p">(</span><span class="n">lat2</span><span class="p">))</span>
         <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="n">dlon</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    
    <span class="n">c</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="nf">atan2</span><span class="p">(</span><span class="n">math</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">math</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">R</span> <span class="o">*</span> <span class="n">c</span>
</code></pre></div></div> <h4 id="finding-optimal-fuel-stops">Finding Optimal Fuel Stops</h4> <p>The core optimization logic:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">find_optimal_stops</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">route_points</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span> 
                      <span class="n">total_distance</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Find optimal fuel stops along the route</span><span class="sh">"""</span>
    <span class="n">current_fuel_range</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">max_range_miles</span>
    <span class="n">total_cost</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">stops</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">current_position</span> <span class="o">=</span> <span class="n">route_points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">distance_remaining</span> <span class="o">=</span> <span class="n">total_distance</span>
    <span class="n">new_route</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># Short route optimization
</span>    <span class="k">if</span> <span class="n">total_distance</span> <span class="o">&lt;=</span> <span class="n">self</span><span class="p">.</span><span class="n">max_range_miles</span><span class="p">:</span>
        <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">Direct route possible - no fuel stops needed</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">route</span><span class="sh">'</span><span class="p">:</span> <span class="n">route_points</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">stops</span><span class="sh">'</span><span class="p">:</span> <span class="p">[],</span>
            <span class="sh">'</span><span class="s">total_cost</span><span class="sh">'</span><span class="p">:</span> <span class="mf">0.0</span>
        <span class="p">}</span>
    
    <span class="c1"># Process each route segment
</span>    <span class="k">for</span> <span class="n">next_point</span> <span class="ow">in</span> <span class="n">route_points</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">segment_distance</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">calculate_distance</span><span class="p">(</span>
            <span class="n">current_position</span><span class="p">,</span> <span class="n">next_point</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">segment_distance</span> <span class="o">&lt;=</span> <span class="n">current_fuel_range</span><span class="p">:</span>
            <span class="c1"># Can reach next point with current fuel
</span>            <span class="n">self</span><span class="p">.</span><span class="nf">_process_direct_segment</span><span class="p">(</span>
                <span class="n">current_position</span><span class="p">,</span> <span class="n">next_point</span><span class="p">,</span> 
                <span class="n">segment_distance</span><span class="p">,</span> <span class="n">new_route</span><span class="p">)</span>
            <span class="n">current_fuel_range</span> <span class="o">-=</span> <span class="n">segment_distance</span>
            <span class="n">current_position</span> <span class="o">=</span> <span class="n">next_point</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Need to find a fuel stop
</span>            <span class="n">station</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_find_fuel_stop</span><span class="p">(</span>
                <span class="n">current_position</span><span class="p">,</span> <span class="n">current_fuel_range</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="n">station</span><span class="p">:</span>
                <span class="k">raise</span> <span class="nc">Exception</span><span class="p">(</span><span class="sh">"</span><span class="s">No reachable fuel stations found</span><span class="sh">"</span><span class="p">)</span>
                
            <span class="n">stop_info</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_process_fuel_stop</span><span class="p">(</span>
                <span class="n">station</span><span class="p">,</span> <span class="n">current_position</span><span class="p">,</span> 
                <span class="n">current_fuel_range</span><span class="p">,</span> <span class="n">total_cost</span><span class="p">)</span>
                
            <span class="n">stops</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">stop_info</span><span class="p">[</span><span class="sh">'</span><span class="s">station</span><span class="sh">'</span><span class="p">])</span>
            <span class="n">total_cost</span> <span class="o">+=</span> <span class="n">stop_info</span><span class="p">[</span><span class="sh">'</span><span class="s">cost</span><span class="sh">'</span><span class="p">]</span>
            <span class="n">current_position</span> <span class="o">=</span> <span class="p">(</span><span class="n">station</span><span class="p">.</span><span class="n">location</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">station</span><span class="p">.</span><span class="n">location</span><span class="p">.</span><span class="n">x</span><span class="p">)</span>
            <span class="n">current_fuel_range</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">max_range_miles</span>
            <span class="n">new_route</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">stop_info</span><span class="p">[</span><span class="sh">'</span><span class="s">location</span><span class="sh">'</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="p">{</span>
        <span class="sh">'</span><span class="s">route</span><span class="sh">'</span><span class="p">:</span> <span class="n">new_route</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">stops</span><span class="sh">'</span><span class="p">:</span> <span class="n">stops</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">total_cost</span><span class="sh">'</span><span class="p">:</span> <span class="n">total_cost</span>
    <span class="p">}</span>
</code></pre></div></div> <h4 id="finding-the-next-fuel-station">Finding the Next Fuel Station</h4> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">_find_fuel_stop</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">current_point</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> 
                    <span class="n">max_range</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FuelStation</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Find the cheapest reachable fuel station</span><span class="sh">"""</span>
    <span class="n">nearby_stations</span> <span class="o">=</span> <span class="p">(</span><span class="n">FuelStation</span><span class="p">.</span><span class="n">objects</span>
        <span class="p">.</span><span class="nf">annotate</span><span class="p">(</span><span class="n">distance</span><span class="o">=</span><span class="nc">Distance</span><span class="p">(</span><span class="sh">'</span><span class="s">location</span><span class="sh">'</span><span class="p">,</span> <span class="n">current_point</span><span class="p">))</span>
        <span class="p">.</span><span class="nf">filter</span><span class="p">(</span><span class="n">distance__lte</span><span class="o">=</span><span class="nc">D</span><span class="p">(</span><span class="n">mi</span><span class="o">=</span><span class="n">max_range</span><span class="p">))</span>
        <span class="p">.</span><span class="nf">order_by</span><span class="p">(</span><span class="sh">'</span><span class="s">retail_price</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">distance</span><span class="sh">'</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">nearby_stations</span><span class="p">.</span><span class="nf">exists</span><span class="p">():</span>
        <span class="k">return</span> <span class="bp">None</span>
        
    <span class="k">return</span> <span class="n">nearby_stations</span><span class="p">.</span><span class="nf">first</span><span class="p">()</span>
</code></pre></div></div> <h3 id="route-visualization">Route Visualization</h3> <p>The diagram below illustrates a sample optimized route with designated fuel stops:</p> <div class="mermaid"> graph LR A[Los Angeles] --&gt;|350mi| B[Station 1] B --&gt;|400mi| C[Station 2] C --&gt;|300mi| D[Station 3] D --&gt;|450mi| E[New York] style A fill:#f96,stroke:#333,stroke-width:2px style E fill:#f96,stroke:#333,stroke-width:2px style B fill:#9f9,stroke:#333,stroke-width:2px style C fill:#9f9,stroke:#333,stroke-width:2px style D fill:#9f9,stroke:#333,stroke-width:2px </div> <h3 id="usage-example">Usage Example</h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Initialize services
</span><span class="n">location_service</span> <span class="o">=</span> <span class="nc">LocationService</span><span class="p">(</span><span class="n">GOOGLE_MAPS_API_KEY</span><span class="p">)</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="nc">GreedyRouteOptimizer</span><span class="p">()</span>

<span class="c1"># Get coordinates
</span><span class="n">start</span> <span class="o">=</span> <span class="n">location_service</span><span class="p">.</span><span class="nf">geocode</span><span class="p">(</span><span class="sh">"</span><span class="s">Los Angeles, CA</span><span class="sh">"</span><span class="p">)</span>
<span class="n">end</span> <span class="o">=</span> <span class="n">location_service</span><span class="p">.</span><span class="nf">geocode</span><span class="p">(</span><span class="sh">"</span><span class="s">New York, NY</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Get route points
</span><span class="n">route_points</span> <span class="o">=</span> <span class="n">location_service</span><span class="p">.</span><span class="nf">get_route</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>

<span class="c1"># Find optimal stops
</span><span class="n">result</span> <span class="o">=</span> <span class="n">optimizer</span><span class="p">.</span><span class="nf">find_optimal_stops</span><span class="p">(</span>
    <span class="n">route_points</span><span class="p">,</span>
    <span class="n">optimizer</span><span class="p">.</span><span class="nf">calculate_distance</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
<span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Total fuel cost: $</span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="sh">'</span><span class="s">total_cost</span><span class="sh">'</span><span class="p">]</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">stop</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="sh">'</span><span class="s">stops</span><span class="sh">'</span><span class="p">]:</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Fuel stop: </span><span class="si">{</span><span class="n">stop</span><span class="p">.</span><span class="n">city</span><span class="si">}</span><span class="s">, </span><span class="si">{</span><span class="n">stop</span><span class="p">.</span><span class="n">state</span><span class="si">}</span><span class="s"> - $</span><span class="si">{</span><span class="n">stop</span><span class="p">.</span><span class="n">retail_price</span><span class="si">}</span><span class="s">/gal</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div> <h3 id="performance-considerations">Performance Considerations</h3> <p>Our implementation is designed with efficiency in mind: <br> • <strong>Spatial Indexing</strong>: Leveraging PostGIS’s built-in spatial indexes for rapid data retrieval.<br> • <strong>Distance Calculations</strong>: Utilizing the Haversine formula for fast and accurate distance approximations.<br> • <strong>Greedy Approach</strong>: A pragmatic algorithm that, while not globally optimal, effectively addresses real-world constraints.</p> <h3 id="future-improvements">Future Improvements</h3> <p>Potential enhancements include: • Integrating real-time fuel pricing data. • Incorporating live traffic and road condition updates. • Supporting simultaneous routing for multiple vehicles. • Implementing time-window constraints for fuel station operations.</p> <h3 id="conclusion">Conclusion</h3> <p>In summary, this implementation offers a robust approach to optimizing vehicle routes under stringent fuel constraints. Although the current solution employs a greedy strategy, it establishes a solid foundation for further enhancements and real-world applications. The complete code is available on <a href="https://github.com/dipespandey/spotter-solution" rel="external nofollow noopener" target="_blank">GitHub</a>, and contributions are welcome to adapt and extend this solution for diverse operational needs.</p> <hr> </article><div id="giscus_thread" style="max-width: 800px; margin: 0 auto;"> <script>let giscusTheme=localStorage.getItem("theme"),giscusAttributes={src:"https://giscus.app/client.js","data-repo":"dipespandey/mypersonalwebsite","data-repo-id":"R_kgDOIn-FpA","data-category":"Comments","data-category-id":"DIC_kwDOIn-FpM4CTY8a","data-mapping":"title","data-strict":"1","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":giscusTheme,"data-lang":"en",crossorigin:"anonymous",async:""},giscusScript=document.createElement("script");Object.entries(giscusAttributes).forEach(([t,e])=>giscusScript.setAttribute(t,e)),document.getElementById("giscus_thread").appendChild(giscusScript);</script> <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a> </noscript> </div> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2025 Dipesh Pandey. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="/assets/js/common.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-141259679-1"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-141259679-1");</script><script async type="text/javascript">!function(e,t,a,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=t.createElement(a),s=t.getElementsByTagName(a)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-141259679-1","auto"),ga("send","pageview");</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>